<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Terminbuchung - iFrame Integration</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: system-ui, -apple-system, sans-serif;
            background: #f5f5f5;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        h1 {
            margin-top: 0;
            color: #1a1a1a;
        }

        .iframe-container {
            width: 100%;
            margin: 20px 0;
            overflow: hidden;
            transition: height 0.3s ease;
        }

        #terminbuchung-iframe {
            width: 100%;
            border: none;
            display: block;
            /* Minimale Starth√∂he */
            min-height: 400px;
        }

        .debug-info {
            margin-top: 20px;
            padding: 15px;
            background: #f0f0f0;
            border-radius: 8px;
            font-size: 14px;
            font-family: monospace;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>üóìÔ∏è Terminbuchung</h1>
    <p>Buchen Sie hier Ihren Termin. Das Formular passt sich automatisch an.</p>

    <!-- iFrame Container -->
    <div class="iframe-container">
        <iframe 
            id="terminbuchung-iframe"
            src="http://localhost:3000"
            title="Terminbuchung"
            scrolling="no"
            allow="clipboard-write"
        ></iframe>
    </div>

    <!-- Debug Info (optional) -->
    <div class="debug-info">
        <strong>Debug:</strong><br>
        iFrame H√∂he: <span id="debug-height">-</span>px<br>
        iFrame Breite: <span id="debug-width">-</span>px<br>
        Letzte Aktualisierung: <span id="debug-time">-</span>
    </div>
</div>

<script>
/**
 * AUTO-RESIZE IFRAME LISTENER
 * Empf√§ngt Gr√∂√üen-Updates vom iFrame und passt die H√∂he dynamisch an
 * ‚ö†Ô∏è WICHTIG: Funktioniert nur wenn beide auf derselben Domain sind
 * oder CORS richtig konfiguriert ist
 */
(function() {
    const iframe = document.getElementById('terminbuchung-iframe');
    const debugHeight = document.getElementById('debug-height');
    const debugWidth = document.getElementById('debug-width');
    const debugTime = document.getElementById('debug-time');

    if (!iframe) {
        console.error('‚ùå iFrame nicht gefunden!');
        return;
    }

    /**
     * H√∂he des iFrames anpassen
     * @param {number} height - Neue H√∂he in Pixeln
     */
    function setIframeHeight(height) {
        // Setze die H√∂he direkt auf den empfangenen Wert
        // KEIN Math.max mehr - wir wollen auch kleiner werden k√∂nnen!
        iframe.style.height = height + 'px';
        
        // Debug Output
        if (debugHeight) debugHeight.textContent = height;
        
        console.log('üìè iFrame H√∂he aktualisiert:', height + 'px');
    }

    /**
     * Message Listener f√ºr postMessage Events vom iFrame
     */
    window.addEventListener('message', function(event) {
        // ‚ö†Ô∏è SICHERHEIT: In Produktion solltest du die Origin pr√ºfen!
        // if (event.origin !== 'https://deine-domain.com') return;

        // Pr√ºfe ob die Message vom iFrame kommt
        if (event.data && event.data.type === 'resize') {
            const { height, width } = event.data;

            // Setze neue H√∂he (auch wenn sie kleiner ist!)
            if (height && typeof height === 'number') {
                setIframeHeight(height);
            }

            // Debug Output
            if (debugWidth && width) debugWidth.textContent = width;
            if (debugTime) {
                const now = new Date();
                debugTime.textContent = now.toLocaleTimeString('de-DE');
            }
        }
    });

    console.log('‚úÖ iFrame Auto-Resize Listener aktiviert');
    console.log('üì° Warte auf Gr√∂√üen-Updates vom iFrame...');
})();
</script>

</body>
</html>
